"use strict";!function(l){l.fn.StickySidebar=function(i){var t,o;function e(i,t){return!0===i.initialized||!(l("body").width()<i.minWidth)&&(t=t,(p=i).initialized=!0,l("head").append(l('<style>.StickySidebar:after {content: ""; display: table; clear: both;}</style>')),t.each(function(){var i={};i.sidebar=l(this),i.options=p||{},i.container=l(i.options.containerSelector),0==i.container.length&&(i.container=i.sidebar.parent()),i.sidebar.parents().css("-webkit-transform","none"),i.sidebar.css({position:"relative",overflow:"visible","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),i.stickySidebar=i.sidebar.find(".StickySidebar"),0==i.stickySidebar.length&&(i.sidebar.find("script").remove(),i.stickySidebar=l("<div>").addClass("StickySidebar").append(i.sidebar.children()),i.sidebar.append(i.stickySidebar)),i.marginTop=parseInt(i.sidebar.css("margin-top")),i.marginBottom=parseInt(i.sidebar.css("margin-bottom")),i.paddingTop=parseInt(i.sidebar.css("padding-top")),i.paddingBottom=parseInt(i.sidebar.css("padding-bottom"));var t,o,e=i.stickySidebar.offset().top,a=i.stickySidebar.outerHeight();function b(){i.fixedScrollTop=0,i.sidebar.css({"min-height":"1px"}),i.stickySidebar.css({position:"static",width:""})}i.stickySidebar.css("padding-top",1),i.stickySidebar.css("padding-bottom",1),e-=i.stickySidebar.offset().top,a=i.stickySidebar.outerHeight()-a-e,0==e?(i.stickySidebar.css("padding-top",0),i.stickySidebarPaddingTop=0):i.stickySidebarPaddingTop=1,0==a?(i.stickySidebar.css("padding-bottom",0),i.stickySidebarPaddingBottom=0):i.stickySidebarPaddingBottom=1,i.previousScrollTop=null,i.fixedScrollTop=0,b(),i.onScroll=function(i){if(i.stickySidebar.is(":visible"))if(l("body").width()<i.options.minWidth)b();else{if(i.options.disableOnResponsiveLayouts)if(i.sidebar.outerWidth("none"==i.sidebar.css("float"))+50>i.container.width())return void b();var t,o,e,a,d,s,n,r=l(document).scrollTop(),c="static";r>=i.container.offset().top+(0-i.options.additionalMarginTop)&&(o=i.paddingTop+i.marginTop+p.additionalMarginTop,d=i.paddingBottom+i.marginBottom+p.additionalMarginBottom,e=i.container.offset().top,a=i.container.offset().top+(n=i.container,s=n.height(),n.children().each(function(){s=Math.max(s,l(this).height())}),s),t=0+p.additionalMarginTop,n=i.stickySidebar.outerHeight()+o+d<l(window).height()?t+i.stickySidebar.outerHeight():l(window).height()-i.marginBottom-i.paddingBottom-p.additionalMarginBottom,o=e-r+i.paddingTop+i.marginTop,d=a-r,e=i.stickySidebar.offset().top-r,a=i.previousScrollTop-r,"fixed"==i.stickySidebar.css("position")&&"modern"==i.options.sidebarBehavior&&(e+=a),"stick-to-top"==i.options.sidebarBehavior&&(e=p.additionalMarginTop),"stick-to-bottom"==i.options.sidebarBehavior&&(e=n-i.stickySidebar.outerHeight()),e=0<a?Math.min(e,t):Math.max(e,n-i.stickySidebar.outerHeight()),e=Math.max(e,o),e=Math.min(e,d-i.stickySidebar.outerHeight()),c=((d=i.container.height()==i.stickySidebar.outerHeight())||e!=t)&&(d||e!=n-i.stickySidebar.outerHeight())?r+e-i.sidebar.offset().top-i.paddingTop<=p.additionalMarginTop?"static":"absolute":"fixed"),"fixed"==c?i.stickySidebar.css({position:"fixed",width:i.sidebar.width(),top:e,left:i.sidebar.offset().left+parseInt(i.sidebar.css("padding-left"))}):"absolute"==c?(n={},"absolute"!=i.stickySidebar.css("position")&&(n.position="absolute",n.top=r+e-i.sidebar.offset().top-i.stickySidebarPaddingTop-i.stickySidebarPaddingBottom),n.width=i.sidebar.width(),n.left="",i.stickySidebar.css(n)):"static"==c&&b(),"static"!=c&&1==i.options.updateSidebarHeight&&i.sidebar.css({"min-height":i.stickySidebar.outerHeight()+i.stickySidebar.offset().top-i.sidebar.offset().top+i.paddingBottom+2}),i.previousScrollTop=r}},i.onScroll(i),l(document).scroll((t=i,function(){t.onScroll(t)})),l(window).resize((o=i,function(){o.stickySidebar.css({position:"static"}),o.onScroll(o)}))}),!0);var p}(i=l.extend({containerSelector:"",additionalMarginTop:0,additionalMarginBottom:0,updateSidebarHeight:!0,minWidth:0,disableOnResponsiveLayouts:!0,sidebarBehavior:"modern"},i)).additionalMarginTop=parseInt(i.additionalMarginTop)||0,i.additionalMarginBottom=parseInt(i.additionalMarginBottom)||0,e(t=i,o=this)||(console.log("TST: Body width smaller than options.minWidth. Init is delayed."),l(document).scroll(function(t,o){return function(i){e(t,o)&&l(this).unbind(i)}}(t,o)),l(window).resize(function(t,o){return function(i){e(t,o)&&l(this).unbind(i)}}(t,o)))}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcm9sbC1zdGlja3kuanMiXSwibmFtZXMiOlsiJCIsImZuIiwiU3RpY2t5U2lkZWJhciIsIm9wdGlvbnMiLCIkdGhhdCIsInRyeUluaXQiLCJpbml0aWFsaXplZCIsIndpZHRoIiwibWluV2lkdGgiLCJhcHBlbmQiLCJlYWNoIiwiY29udGFpbmVyIiwibyIsImxlbmd0aCIsInRoaXMiLCJjb250YWluZXJTZWxlY3RvciIsImNzcyIsInNpZGViYXIiLCJwYXJlbnQiLCJwYXJlbnRzIiwicG9zaXRpb24iLCJvdmVyZmxvdyIsIi13ZWJraXQtYm94LXNpemluZyIsInN0aWNreVNpZGViYXIiLCJmaW5kIiwicmVtb3ZlIiwicGFyc2VJbnQiLCJhZGRDbGFzcyIsImNoaWxkcmVuIiwibWFyZ2luQm90dG9tIiwiY29sbGFwc2VkVG9wSGVpZ2h0Iiwib2Zmc2V0IiwiY29sbGFwc2VkQm90dG9tSGVpZ2h0Iiwib3V0ZXJIZWlnaHQiLCJ0b3AiLCJoZWlnaHQiLCJyZXNldFNpZGViYXIiLCJmaXhlZFNjcm9sbFRvcCIsIm1pbi1oZWlnaHQiLCJzdGlja3lTaWRlYmFyUGFkZGluZ1RvcCIsInN0aWNreVNpZGViYXJQYWRkaW5nQm90dG9tIiwicHJldmlvdXNTY3JvbGxUb3AiLCJvblNjcm9sbCIsImlzIiwic2lkZWJhcldpZHRoIiwib3V0ZXJXaWR0aCIsImRpc2FibGVPblJlc3BvbnNpdmVMYXlvdXRzIiwic3RhdGljTGltaXRCb3R0b20iLCJzaWRlYmFyQmVoYXZpb3IiLCJzaWRlYmFyU2FtZUhlaWdodEFzQ29udGFpbmVyIiwic2Nyb2xsVG9wIiwiZG9jdW1lbnQiLCJjb250YWluZXJUb3AiLCJ3aW5kb3dPZmZzZXRCb3R0b20iLCJhZGRpdGlvbmFsTWFyZ2luVG9wIiwib2Zmc2V0VG9wIiwicGFkZGluZ1RvcCIsIm1hcmdpblRvcCIsInNpZGViYXJTbWFsbGVyVGhhbldpbmRvdyIsInBhZGRpbmdCb3R0b20iLCJhZGRpdGlvbmFsTWFyZ2luQm90dG9tIiwiY29udGFpbmVyQm90dG9tIiwiZSIsIk1hdGgiLCJtYXgiLCJvZmZzZXRCb3R0b20iLCJ3aW5kb3ciLCJ3aW5kb3dPZmZzZXRUb3AiLCJzY3JvbGxUb3BEaWZmIiwibWluIiwic3RhdGljTGltaXRUb3AiLCJsZWZ0IiwidXBkYXRlU2lkZWJhckhlaWdodCIsImdldENsZWFyZWRIZWlnaHQiLCJleHRlbmQiLCJkZWZhdWx0cyIsInNjcm9sbCIsInN1Y2Nlc3MiLCJldnQiLCJ1bmJpbmQiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJjQUFBLFNBQVdBLEdBQ1BBLEVBQUVDLEdBQUdDLGNBQWdCLFNBQVVDLEdBRGxDLElBcUIwQ0MsRUFBL0JBLEVBNkJJLFNBQU9DLEVBQVBGLEVBQUFDLEdBQ0gsT0FBQSxJQUFBRCxFQUFBRyxlQUlBTixFQUFBLFFBQUFPLFFBQUFKLEVBQUFLLFlBWWtCSixFQUx2QkEsR0FLSUQsRUFMSkEsR0FPZUcsYUFBWSxFQUZ2Qk4sRUFBRSxRQUFRUyxPQUFPVCxFQUFFLG9GQUVuQkksRUFBTU0sS0FBSyxXQVNMQyxJQUFGQyxFQUFnQkEsR0FDVkQsRUFBQUEsUUFBVUUsRUFBWkMsTUFKSkYsRUFBRVQsUUFBVUEsR0FBVyxHQUd2QlMsRUFBRUQsVUFBWVgsRUFBRVksRUFBRVQsUUFBUVksbUJBT1osR0FBSkMsRUFBSUwsVUFBQUUsU0FDVkQsRUFBWUQsVUFERkMsRUFBQUssUUFBQUMsVUFLVk4sRUFBQUssUUFBQUUsVUFBbUJILElBQUEsb0JBTFQsUUFNVkosRUFBQUssUUFBY0QsSUFBQSxDQUdsQkksU0FBQSxXQVBJQyxTQUFZLFVBRVpDLHFCQUFzQixhQU9wQkMsa0JBQU4sYUFDY0MsYUFBVixlQUtKWixFQUFBVyxjQUFBWCxFQUFBSyxRQUFBTyxLQUFBLGtCQU44QixHQUExQlosRUFBRVcsY0FBY1YsU0FDaEJELEVBQUVLLFFBQVFPLEtBQUssVUFBVUMsU0FNN0JiLEVBQWNjLGNBQVdULEVBQUYsU0FBY1UsU0FBZixpQkFBdEJsQixPQUFBRyxFQUFBSyxRQUFBVyxZQUNFQyxFQUFGWixR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b2xsLXN0aWNreS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCQpIHtcbiAgICAkLmZuLlN0aWNreVNpZGViYXIgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB2YXIgZGVmYXVsdHMgPSB7XG4gICAgICAgICAgICAnY29udGFpbmVyU2VsZWN0b3InOiAnJyxcbiAgICAgICAgICAgICdhZGRpdGlvbmFsTWFyZ2luVG9wJzogMCxcbiAgICAgICAgICAgICdhZGRpdGlvbmFsTWFyZ2luQm90dG9tJzogMCxcbiAgICAgICAgICAgICd1cGRhdGVTaWRlYmFySGVpZ2h0JzogdHJ1ZSxcbiAgICAgICAgICAgICdtaW5XaWR0aCc6IDAsXG4gICAgICAgICAgICAnZGlzYWJsZU9uUmVzcG9uc2l2ZUxheW91dHMnOiB0cnVlLFxuICAgICAgICAgICAgJ3NpZGViYXJCZWhhdmlvcic6ICdtb2Rlcm4nXG4gICAgICAgIH07XG4gICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZChkZWZhdWx0cywgb3B0aW9ucyk7XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgb3B0aW9uc1xuICAgICAgICBvcHRpb25zLmFkZGl0aW9uYWxNYXJnaW5Ub3AgPSBwYXJzZUludChvcHRpb25zLmFkZGl0aW9uYWxNYXJnaW5Ub3ApIHx8IDA7XG4gICAgICAgIG9wdGlvbnMuYWRkaXRpb25hbE1hcmdpbkJvdHRvbSA9IHBhcnNlSW50KG9wdGlvbnMuYWRkaXRpb25hbE1hcmdpbkJvdHRvbSkgfHwgMDtcblxuICAgICAgICB0cnlJbml0T3JIb29rSW50b0V2ZW50cyhvcHRpb25zLCB0aGlzKTtcblxuICAgICAgICAvLyBUcnkgZG9pbmcgaW5pdCwgb3RoZXJ3aXNlIGhvb2sgaW50byB3aW5kb3cucmVzaXplIGFuZCBkb2N1bWVudC5zY3JvbGwgYW5kIHRyeSBhZ2FpbiB0aGVuLlxuICAgICAgICBmdW5jdGlvbiB0cnlJbml0T3JIb29rSW50b0V2ZW50cyhvcHRpb25zLCAkdGhhdCkge1xuICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB0cnlJbml0KG9wdGlvbnMsICR0aGF0KTtcblxuICAgICAgICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1RTVDogQm9keSB3aWR0aCBzbWFsbGVyIHRoYW4gb3B0aW9ucy5taW5XaWR0aC4gSW5pdCBpcyBkZWxheWVkLicpO1xuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkuc2Nyb2xsKGZ1bmN0aW9uIChvcHRpb25zLCAkdGhhdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB0cnlJbml0KG9wdGlvbnMsICR0aGF0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnVuYmluZChldnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0ob3B0aW9ucywgJHRoYXQpKTtcbiAgICAgICAgICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uIChvcHRpb25zLCAkdGhhdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB0cnlJbml0KG9wdGlvbnMsICR0aGF0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnVuYmluZChldnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0ob3B0aW9ucywgJHRoYXQpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVHJ5IGRvaW5nIGluaXQgaWYgcHJvcGVyIGNvbmRpdGlvbnMgYXJlIG1ldC5cbiAgICAgICAgZnVuY3Rpb24gdHJ5SW5pdChvcHRpb25zLCAkdGhhdCkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuaW5pdGlhbGl6ZWQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCQoJ2JvZHknKS53aWR0aCgpIDwgb3B0aW9ucy5taW5XaWR0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaW5pdChvcHRpb25zLCAkdGhhdCk7XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSW5pdCB0aGUgc3RpY2t5IHNpZGViYXIocykuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQob3B0aW9ucywgJHRoYXQpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTXG4gICAgICAgICAgICAkKCdoZWFkJykuYXBwZW5kKCQoJzxzdHlsZT4uU3RpY2t5U2lkZWJhcjphZnRlciB7Y29udGVudDogXCJcIjsgZGlzcGxheTogdGFibGU7IGNsZWFyOiBib3RoO308L3N0eWxlPicpKTtcblxuICAgICAgICAgICAgJHRoYXQuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG8gPSB7fTtcblxuICAgICAgICAgICAgICAgIG8uc2lkZWJhciA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICAvLyBTYXZlIG9wdGlvbnNcbiAgICAgICAgICAgICAgICBvLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IGNvbnRhaW5lclxuICAgICAgICAgICAgICAgIG8uY29udGFpbmVyID0gJChvLm9wdGlvbnMuY29udGFpbmVyU2VsZWN0b3IpO1xuICAgICAgICAgICAgICAgIGlmIChvLmNvbnRhaW5lci5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBvLmNvbnRhaW5lciA9IG8uc2lkZWJhci5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgc3RpY2t5IHNpZGViYXJcbiAgICAgICAgICAgICAgICBvLnNpZGViYXIucGFyZW50cygpLmNzcygnLXdlYmtpdC10cmFuc2Zvcm0nLCAnbm9uZScpOyAvLyBGaXggZm9yIFdlYktpdCBidWcgLSBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MjA1NzRcbiAgICAgICAgICAgICAgICBvLnNpZGViYXIuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgJ292ZXJmbG93JzogJ3Zpc2libGUnLFxuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgXCJib3gtc2l6aW5nXCIgbXVzdCBiZSBzZXQgdG8gXCJjb250ZW50LWJveFwiIGJlY2F1c2Ugd2Ugc2V0IGEgZml4ZWQgaGVpZ2h0IHRvIHRoaXMgZWxlbWVudCB3aGVuIHRoZSBzdGlja3kgc2lkZWJhciBoYXMgYSBmaXhlZCBwb3NpdGlvbi5cbiAgICAgICAgICAgICAgICAgICAgJy13ZWJraXQtYm94LXNpemluZyc6ICdib3JkZXItYm94JyxcbiAgICAgICAgICAgICAgICAgICAgJy1tb3otYm94LXNpemluZyc6ICdib3JkZXItYm94JyxcbiAgICAgICAgICAgICAgICAgICAgJ2JveC1zaXppbmcnOiAnYm9yZGVyLWJveCdcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgc3RpY2t5IHNpZGViYXIgZWxlbWVudC4gSWYgbm9uZSBoYXMgYmVlbiBmb3VuZCwgdGhlbiBjcmVhdGUgb25lLlxuICAgICAgICAgICAgICAgIG8uc3RpY2t5U2lkZWJhciA9IG8uc2lkZWJhci5maW5kKCcuU3RpY2t5U2lkZWJhcicpO1xuICAgICAgICAgICAgICAgIGlmIChvLnN0aWNreVNpZGViYXIubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgby5zaWRlYmFyLmZpbmQoJ3NjcmlwdCcpLnJlbW92ZSgpOyAvLyBSZW1vdmUgPHNjcmlwdD4gdGFncywgb3RoZXJ3aXNlIHRoZXkgd2lsbCBiZSBydW4gYWdhaW4gb24gdGhlIG5leHQgbGluZS5cbiAgICAgICAgICAgICAgICAgICAgby5zdGlja3lTaWRlYmFyID0gJCgnPGRpdj4nKS5hZGRDbGFzcygnU3RpY2t5U2lkZWJhcicpLmFwcGVuZChvLnNpZGViYXIuY2hpbGRyZW4oKSk7XG4gICAgICAgICAgICAgICAgICAgIG8uc2lkZWJhci5hcHBlbmQoby5zdGlja3lTaWRlYmFyKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBHZXQgZXhpc3RpbmcgdG9wIGFuZCBib3R0b20gbWFyZ2lucyBhbmQgcGFkZGluZ3NcbiAgICAgICAgICAgICAgICBvLm1hcmdpblRvcCA9IHBhcnNlSW50KG8uc2lkZWJhci5jc3MoJ21hcmdpbi10b3AnKSk7XG4gICAgICAgICAgICAgICAgby5tYXJnaW5Cb3R0b20gPSBwYXJzZUludChvLnNpZGViYXIuY3NzKCdtYXJnaW4tYm90dG9tJykpO1xuICAgICAgICAgICAgICAgIG8ucGFkZGluZ1RvcCA9IHBhcnNlSW50KG8uc2lkZWJhci5jc3MoJ3BhZGRpbmctdG9wJykpO1xuICAgICAgICAgICAgICAgIG8ucGFkZGluZ0JvdHRvbSA9IHBhcnNlSW50KG8uc2lkZWJhci5jc3MoJ3BhZGRpbmctYm90dG9tJykpO1xuXG4gICAgICAgICAgICAgICAgLy8gQWRkIGEgdGVtcG9yYXJ5IHBhZGRpbmcgcnVsZSB0byBjaGVjayBmb3IgY29sbGFwc2FibGUgbWFyZ2lucy5cbiAgICAgICAgICAgICAgICB2YXIgY29sbGFwc2VkVG9wSGVpZ2h0ID0gby5zdGlja3lTaWRlYmFyLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgICAgICB2YXIgY29sbGFwc2VkQm90dG9tSGVpZ2h0ID0gby5zdGlja3lTaWRlYmFyLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgby5zdGlja3lTaWRlYmFyLmNzcygncGFkZGluZy10b3AnLCAxKTtcbiAgICAgICAgICAgICAgICBvLnN0aWNreVNpZGViYXIuY3NzKCdwYWRkaW5nLWJvdHRvbScsIDEpO1xuICAgICAgICAgICAgICAgIGNvbGxhcHNlZFRvcEhlaWdodCAtPSBvLnN0aWNreVNpZGViYXIub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgICAgIGNvbGxhcHNlZEJvdHRvbUhlaWdodCA9IG8uc3RpY2t5U2lkZWJhci5vdXRlckhlaWdodCgpIC0gY29sbGFwc2VkQm90dG9tSGVpZ2h0IC0gY29sbGFwc2VkVG9wSGVpZ2h0O1xuICAgICAgICAgICAgICAgIGlmIChjb2xsYXBzZWRUb3BIZWlnaHQgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBvLnN0aWNreVNpZGViYXIuY3NzKCdwYWRkaW5nLXRvcCcsIDApO1xuICAgICAgICAgICAgICAgICAgICBvLnN0aWNreVNpZGViYXJQYWRkaW5nVG9wID0gMDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvLnN0aWNreVNpZGViYXJQYWRkaW5nVG9wID0gMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY29sbGFwc2VkQm90dG9tSGVpZ2h0ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgby5zdGlja3lTaWRlYmFyLmNzcygncGFkZGluZy1ib3R0b20nLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgby5zdGlja3lTaWRlYmFyUGFkZGluZ0JvdHRvbSA9IDA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgby5zdGlja3lTaWRlYmFyUGFkZGluZ0JvdHRvbSA9IDE7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gV2UgdXNlIHRoaXMgdG8ga25vdyB3aGV0aGVyIHRoZSB1c2VyIGlzIHNjcm9sbGluZyB1cCBvciBkb3duLlxuICAgICAgICAgICAgICAgIG8ucHJldmlvdXNTY3JvbGxUb3AgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgLy8gU2Nyb2xsIHRvcCAodmFsdWUpIHdoZW4gdGhlIHNpZGViYXIgaGFzIGZpeGVkIHBvc2l0aW9uLlxuICAgICAgICAgICAgICAgIG8uZml4ZWRTY3JvbGxUb3AgPSAwO1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHNpZGViYXIgdG8gZGVmYXVsdCB2YWx1ZXMuXG4gICAgICAgICAgICAgICAgcmVzZXRTaWRlYmFyKCk7XG5cbiAgICAgICAgICAgICAgICBvLm9uU2Nyb2xsID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBpZiB0aGUgc2lkZWJhciBpc24ndCB2aXNpYmxlLlxuICAgICAgICAgICAgICAgICAgICBpZiAoIW8uc3RpY2t5U2lkZWJhci5pcyhcIjp2aXNpYmxlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIGlmIHRoZSB3aW5kb3cgaXMgdG9vIHNtYWxsLlxuICAgICAgICAgICAgICAgICAgICBpZiAoJCgnYm9keScpLndpZHRoKCkgPCBvLm9wdGlvbnMubWluV2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0U2lkZWJhcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCBpZiB0aGUgc2lkZWJhciB3aWR0aCBpcyBsYXJnZXIgdGhhbiB0aGUgY29udGFpbmVyIHdpZHRoIChlLmcuIHRoZSB0aGVtZSBpcyByZXNwb25zaXZlIGFuZCB0aGUgc2lkZWJhciBpcyBub3cgYmVsb3cgdGhlIGNvbnRlbnQpXG4gICAgICAgICAgICAgICAgICAgIGlmIChvLm9wdGlvbnMuZGlzYWJsZU9uUmVzcG9uc2l2ZUxheW91dHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaWRlYmFyV2lkdGggPSBvLnNpZGViYXIub3V0ZXJXaWR0aChvLnNpZGViYXIuY3NzKCdmbG9hdCcpID09ICdub25lJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaWRlYmFyV2lkdGggKyA1MCA+IG8uY29udGFpbmVyLndpZHRoKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldFNpZGViYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsVG9wID0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9ICdzdGF0aWMnO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSB1c2VyIGhhcyBzY3JvbGxlZCBkb3duIGVub3VnaCBmb3IgdGhlIHNpZGViYXIgdG8gYmUgY2xpcHBlZCBhdCB0aGUgdG9wLCB0aGVuIHdlIGNhbiBjb25zaWRlciBjaGFuZ2luZyBpdHMgcG9zaXRpb24uXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbFRvcCA+PSBvLmNvbnRhaW5lci5vZmZzZXQoKS50b3AgKyAoMCAtIG8ub3B0aW9ucy5hZGRpdGlvbmFsTWFyZ2luVG9wKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHRvcCBhbmQgYm90dG9tIG9mZnNldHMsIHVzZWQgaW4gdmFyaW91cyBjYWxjdWxhdGlvbnMuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0VG9wID0gby5wYWRkaW5nVG9wICsgby5tYXJnaW5Ub3AgKyBvcHRpb25zLmFkZGl0aW9uYWxNYXJnaW5Ub3A7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0Qm90dG9tID0gby5wYWRkaW5nQm90dG9tICsgby5tYXJnaW5Cb3R0b20gKyBvcHRpb25zLmFkZGl0aW9uYWxNYXJnaW5Cb3R0b207XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFsbCB0b3AgYW5kIGJvdHRvbSBwb3NpdGlvbnMgYXJlIHJlbGF0aXZlIHRvIHRoZSB3aW5kb3csIG5vdCB0byB0aGUgcGFyZW50IGVsZW1udHMuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyVG9wID0gby5jb250YWluZXIub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lckJvdHRvbSA9IG8uY29udGFpbmVyLm9mZnNldCgpLnRvcCArIGdldENsZWFyZWRIZWlnaHQoby5jb250YWluZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgdG9wIGFuZCBib3R0b20gb2Zmc2V0cyByZWxhdGl2ZSB0byB0aGUgd2luZG93IHNjcmVlbiB0b3AgKHplcm8pIGFuZCBib3R0b20gKHdpbmRvdyBoZWlnaHQpLlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdpbmRvd09mZnNldFRvcCA9IDAgKyBvcHRpb25zLmFkZGl0aW9uYWxNYXJnaW5Ub3A7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgd2luZG93T2Zmc2V0Qm90dG9tO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2lkZWJhclNtYWxsZXJUaGFuV2luZG93ID0gKG8uc3RpY2t5U2lkZWJhci5vdXRlckhlaWdodCgpICsgb2Zmc2V0VG9wICsgb2Zmc2V0Qm90dG9tKSA8ICQod2luZG93KS5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaWRlYmFyU21hbGxlclRoYW5XaW5kb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dPZmZzZXRCb3R0b20gPSB3aW5kb3dPZmZzZXRUb3AgKyBvLnN0aWNreVNpZGViYXIub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93T2Zmc2V0Qm90dG9tID0gJCh3aW5kb3cpLmhlaWdodCgpIC0gby5tYXJnaW5Cb3R0b20gLSBvLnBhZGRpbmdCb3R0b20gLSBvcHRpb25zLmFkZGl0aW9uYWxNYXJnaW5Cb3R0b207XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0aWNMaW1pdFRvcCA9IGNvbnRhaW5lclRvcCAtIHNjcm9sbFRvcCArIG8ucGFkZGluZ1RvcCArIG8ubWFyZ2luVG9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXRpY0xpbWl0Qm90dG9tID0gY29udGFpbmVyQm90dG9tIC0gc2Nyb2xsVG9wO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9wID0gby5zdGlja3lTaWRlYmFyLm9mZnNldCgpLnRvcCAtIHNjcm9sbFRvcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3BEaWZmID0gby5wcmV2aW91c1Njcm9sbFRvcCAtIHNjcm9sbFRvcDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHNpZGViYXIgcG9zaXRpb24gaXMgZml4ZWQsIHRoZW4gaXQgd29uJ3QgbW92ZSB1cCBvciBkb3duIGJ5IGl0c2VsZi4gU28sIHdlIG1hbnVhbGx5IGFkanVzdCB0aGUgdG9wIGNvb3JkaW5hdGUuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5zdGlja3lTaWRlYmFyLmNzcygncG9zaXRpb24nKSA9PSAnZml4ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8ub3B0aW9ucy5zaWRlYmFyQmVoYXZpb3IgPT0gJ21vZGVybicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wICs9IHNjcm9sbFRvcERpZmY7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5vcHRpb25zLnNpZGViYXJCZWhhdmlvciA9PSAnc3RpY2stdG8tdG9wJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IG9wdGlvbnMuYWRkaXRpb25hbE1hcmdpblRvcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8ub3B0aW9ucy5zaWRlYmFyQmVoYXZpb3IgPT0gJ3N0aWNrLXRvLWJvdHRvbScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3AgPSB3aW5kb3dPZmZzZXRCb3R0b20gLSBvLnN0aWNreVNpZGViYXIub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjcm9sbFRvcERpZmYgPiAwKSB7IC8vIElmIHRoZSB1c2VyIGlzIHNjcm9sbGluZyB1cC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3AgPSBNYXRoLm1pbih0b3AsIHdpbmRvd09mZnNldFRvcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBJZiB0aGUgdXNlciBpcyBzY3JvbGxpbmcgZG93bi5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3AgPSBNYXRoLm1heCh0b3AsIHdpbmRvd09mZnNldEJvdHRvbSAtIG8uc3RpY2t5U2lkZWJhci5vdXRlckhlaWdodCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0gTWF0aC5tYXgodG9wLCBzdGF0aWNMaW1pdFRvcCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IE1hdGgubWluKHRvcCwgc3RhdGljTGltaXRCb3R0b20gLSBvLnN0aWNreVNpZGViYXIub3V0ZXJIZWlnaHQoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzaWRlYmFyIGlzIHRoZSBzYW1lIGhlaWdodCBhcyB0aGUgY29udGFpbmVyLCB3ZSB3b24ndCB1c2UgZml4ZWQgcG9zaXRpb25pbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2lkZWJhclNhbWVIZWlnaHRBc0NvbnRhaW5lciA9IG8uY29udGFpbmVyLmhlaWdodCgpID09IG8uc3RpY2t5U2lkZWJhci5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNpZGViYXJTYW1lSGVpZ2h0QXNDb250YWluZXIgJiYgdG9wID09IHdpbmRvd09mZnNldFRvcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gJ2ZpeGVkJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXNpZGViYXJTYW1lSGVpZ2h0QXNDb250YWluZXIgJiYgdG9wID09IHdpbmRvd09mZnNldEJvdHRvbSAtIG8uc3RpY2t5U2lkZWJhci5vdXRlckhlaWdodCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY3JvbGxUb3AgKyB0b3AgLSBvLnNpZGViYXIub2Zmc2V0KCkudG9wIC0gby5wYWRkaW5nVG9wIDw9IG9wdGlvbnMuYWRkaXRpb25hbE1hcmdpblRvcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0dWNrIHRvIHRoZSB0b3Agb2YgdGhlIHBhZ2UuIE5vIHNwZWNpYWwgYmVoYXZpb3IuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAnc3RhdGljJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3R1Y2sgdG8gdGhlIGJvdHRvbSBvZiB0aGUgcGFnZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgKiBQZXJmb3JtYW5jZSBub3RpY2U6IEl0J3MgT0sgdG8gc2V0IHRoZXNlIENTUyB2YWx1ZXMgYXQgZWFjaCByZXNpemUvc2Nyb2xsLCBldmVuIGlmIHRoZXkgZG9uJ3QgY2hhbmdlLlxuICAgICAgICAgICAgICAgICAgICAgKiBJdCdzIHdheSBzbG93ZXIgdG8gZmlyc3QgY2hlY2sgaWYgdGhlIHZhbHVlcyBoYXZlIGNoYW5nZWQuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24gPT0gJ2ZpeGVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgby5zdGlja3lTaWRlYmFyLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2ZpeGVkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnd2lkdGgnOiBvLnNpZGViYXIud2lkdGgoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG9wJzogdG9wLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsZWZ0Jzogby5zaWRlYmFyLm9mZnNldCgpLmxlZnQgKyBwYXJzZUludChvLnNpZGViYXIuY3NzKCdwYWRkaW5nLWxlZnQnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09ICdhYnNvbHV0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjc3MgPSB7fTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8uc3RpY2t5U2lkZWJhci5jc3MoJ3Bvc2l0aW9uJykgIT0gJ2Fic29sdXRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzcy5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzLnRvcCA9IHNjcm9sbFRvcCArIHRvcCAtIG8uc2lkZWJhci5vZmZzZXQoKS50b3AgLSBvLnN0aWNreVNpZGViYXJQYWRkaW5nVG9wIC0gby5zdGlja3lTaWRlYmFyUGFkZGluZ0JvdHRvbTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzLndpZHRoID0gby5zaWRlYmFyLndpZHRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MubGVmdCA9ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnN0aWNreVNpZGViYXIuY3NzKGNzcyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT0gJ3N0YXRpYycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0U2lkZWJhcigpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uICE9ICdzdGF0aWMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5vcHRpb25zLnVwZGF0ZVNpZGViYXJIZWlnaHQgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2lkZWJhci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWluLWhlaWdodCc6IG8uc3RpY2t5U2lkZWJhci5vdXRlckhlaWdodCgpICsgby5zdGlja3lTaWRlYmFyLm9mZnNldCgpLnRvcCAtIG8uc2lkZWJhci5vZmZzZXQoKS50b3AgKyBvLnBhZGRpbmdCb3R0b20gKyAyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBvLnByZXZpb3VzU2Nyb2xsVG9wID0gc2Nyb2xsVG9wO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBzaWRlYmFyJ3MgcG9zaXRpb24uXG4gICAgICAgICAgICAgICAgby5vblNjcm9sbChvKTtcblxuICAgICAgICAgICAgICAgIC8vIFJlY2FsY3VsYXRlIHRoZSBzaWRlYmFyJ3MgcG9zaXRpb24gb24gZXZlcnkgc2Nyb2xsIGFuZCByZXNpemUuXG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkuc2Nyb2xsKGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvLm9uU2Nyb2xsKG8pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0obykpO1xuICAgICAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG8uc3RpY2t5U2lkZWJhci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdzdGF0aWMnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG8ub25TY3JvbGwobyk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfShvKSk7XG5cbiAgICAgICAgICAgICAgICAvLyBSZXNldCB0aGUgc2lkZWJhciB0byBpdHMgZGVmYXVsdCBzdGF0ZVxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0U2lkZWJhcigpIHtcbiAgICAgICAgICAgICAgICAgICAgby5maXhlZFNjcm9sbFRvcCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIG8uc2lkZWJhci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21pbi1oZWlnaHQnOiAnMXB4J1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgby5zdGlja3lTaWRlYmFyLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAnc3RhdGljJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICd3aWR0aCc6ICcnXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgaGVpZ2h0IG9mIGEgZGl2IGFzIGlmIGl0cyBmbG9hdGVkIGNoaWxkcmVuIHdlcmUgY2xlYXJlZC4gTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gZmFpbHMgaWYgdGhlIGZsb2F0cyBhcmUgbW9yZSB0aGFuIG9uZSBsZXZlbCBkZWVwLlxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldENsZWFyZWRIZWlnaHQoZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gZS5oZWlnaHQoKTtcblxuICAgICAgICAgICAgICAgICAgICBlLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBNYXRoLm1heChoZWlnaHQsICQodGhpcykuaGVpZ2h0KCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGVpZ2h0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufSkoalF1ZXJ5KTsiXX0=